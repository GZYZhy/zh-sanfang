# 影视三方通话设备系统需求文档

## 1. 项目概述
基于电脑和ESP32的四方语音通话系统，电脑作为WiFi热点主设备，三个ESP32作为从设备连接蓝牙耳机，实现实时多方语音通话。

## 2. 系统架构

### 2.1 硬件架构
```
电脑 (主设备)
  ├── WiFi热点 (SSID/密码固定)
  ├── Web控制界面
  ├── 音频混合处理
  └── 录音功能
  │
  ├── ESP32设备1 (从设备)
  │   ├── 蓝牙耳机连接
  │   ├── GPIO22 LED状态灯
  │   ├── RGB LED Tally灯
  │   └── 闭麦按键
  │
  ├── ESP32设备2 (从设备)
  │   └── (同上配置)
  │
  └── ESP32设备3 (从设备)
      └── (同上配置)
```

### 2.2 软件架构
- **电脑端后端**: Python (Flask/FastAPI)
- **电脑端前端**: HTML/CSS/JavaScript (Web界面)
- **ESP32固件**: Arduino C++ (精简实现)
- **通信协议**: WebSocket + UDP音频流

## 3. 功能需求

### 3.1 核心功能
1. **网络连接**
   - 电脑创建WiFi热点 (固定SSID和密码)
   - ESP32自动连接热点
   - 心跳检测保持连接状态

2. **音频通信**
   - 实时四方语音通话
   - 音频数据混合处理(电脑端)
   - 低延迟音频传输

3. **设备管理**
   - ESP32蓝牙耳机配对管理
   - 设备状态监控
   - 掉线自动重连

### 3.2 控制功能
1. **闭麦功能**
   - 按键短按切换麦克风状态
   - 默认开启状态
   - 闭麦时仅接收音频

2. **状态指示灯**
   - GPIO22 LED:
     - 常亮: 开麦状态
     - 缓慢闪烁: 闭麦状态  
     - 快速闪烁: 连接失败

3. **Tally指示灯**
   - RGB LED四种模式:
     - 绿灯: 正常状态
     - 红灯: 警告状态
     - 黄灯闪烁: 待机状态
     - 不亮: 关闭状态

4. **电脑控制**
   - 实时状态显示
   - 远程控制功能
   - 录音功能

## 4. 技术实现细节

### 4.1 ESP32端实现
```cpp
// 伪代码示例
void setup() {
  // 初始化WiFi连接
  // 初始化蓝牙音频
  // 初始化GPIO引脚
  // 连接WebSocket服务器
}

void loop() {
  // 处理音频输入输出
  // 检测按键状态
  // 更新LED状态
  // 维持心跳连接
}
```

### 4.2 电脑端实现
- **后端服务**: Python Web框架 + 音频处理库
- **前端界面**: 响应式Web设计
- **音频处理**: 实时混音和编码
- **网络通信**: WebSocket控制 + UDP音频流

## 5. 性能要求
- 音频延迟: <100ms
- 网络稳定性: 掉线自动恢复
- 资源占用: ESP32内存优化
- 并发处理: 支持3个从设备

## 6. 安全要求
- WiFi热点密码保护
- 设备身份验证
- 音频数据加密(可选)

## 7. 测试计划
- 单元测试: 各模块功能验证
- 集成测试: 系统整体功能测试
- 压力测试: 多设备并发测试
- 用户体验测试: 界面易用性测试